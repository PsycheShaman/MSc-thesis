---
title: "Pad Response Function"
author: "Gerhard Viljoen"
date: "12/11/2018"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r}
require(bigints)
```


#Pad Response Function

The surface charge density induced on the metal surface of the cathode pad plane, by a charge $q$ at a distance $x_0$ from the pad plane, is given by:

$$\sigma (y,z) = \epsilon_0 E_x(y,z)$$

$$where$$

$$E_x(y,z)=- \frac{qx_0}{2\pi\epsilon_0(x_0^2+y^2+z^2)^\frac{2}{3}}$$
$$and$$


$$E_z=E_y=0$$

Integrating this charge density over the metal surface, gives the total charge $Q$ induced on the cathode pad plane, as follows:

$$Q=\int_{-\infty}^\infty\int_{-\infty}^\infty\sigma(y,z)dydz = -q$$

Using this approach of integration over each pad

```{r,echo=F}
#rm(list=ls())
# load("j.rdata")
# rm(f)
# rm(files)
# rm(i)
```

#Remove entries with missing pad data:

```{r,echo=F}
# require(jsonlite)
# 
# error <- c()
# 
# for(i in 1:length(j)){
#   if(is.null(dim(j[[i]]$layer0))[1]|is.null(dim(j[[i]]$layer0)[2])){
#     print(paste0(as.character(100*i/length(j)),"%"))
#     error <- c(error,i)
#   }
# }
# 
# e.l <- length(error)
# 
# for(i in error){
#   j[[i]] <- NULL
# }
# 
# save.image(file="j.rdata")

rm(list=ls())
load("j.rdata")
print(paste0("Removed ",e.l," entries"))
```

#Get a Look-Up Table for Tracks within Events:

* Use EventID, trackID, v0ID, and PDG code to get the indices in the full event list that pertain to a specific track:

```{r}
events <- sapply(j,`[[`,"Event")
events <- as.numeric(events)

tracks <- sapply(j, `[[`,"track")
tracks <- as.numeric(tracks)

v0s <- sapply(j, `[[`,"V0TrackID")
v0s <- as.numeric(v0s)

pdg <- sapply(j, `[[`,"pdgCode")
pdg <- as.numeric(pdg)

```

* Seperate out the detector traces for these events:

```{r}

detectors <- sapply(j, `[[`,"det0")

columns <- sapply(j, `[[`,"col0")

rows <- sapply(j,`[[`,"row0")

pads <- sapply(j,`[[`,"layer0")
```

* Create the Look-Up Tables for electrons and pions:

```{r}
# look.up.table <- data.frame(cbind(events,tracks,v0s,pdg))
# look.up.table$index <- 1:nrow(look.up.table)

look.up.table <- data.frame(cbind(pdg,1:length(pdg)))
names(look.up.table) <- c("pdg","index")

electrons <- look.up.table[which(look.up.table$pdg %in% pdg.elec),]
pions <- look.up.table[which(look.up.table$pdg %in% pdg.pion),]

electrons <- unique(electrons)
pions <- unique(pions)
```

* Create a unique identifier for a specific track, by concatenating its eventID and trackID, and get the number of detector hits for that unique ID:

```{r}

```













