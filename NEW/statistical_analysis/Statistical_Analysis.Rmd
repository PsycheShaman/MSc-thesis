---
title: "Statistical Analysis of Thesis Data"
author: "CG Viljoen - VLJCHR004"
date: "06/05/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message = F,warning = F)
```

```{r}
rm(list=ls())

wrangle <- function(dirX){
  
  require(jsonlite)
  
  files <- list.files(path=paste0(dirX),
                      pattern="*json",
                      full.names=T,
                      recursive=TRUE)
  
  j <- fromJSON(files[1])
  
  #print("---------------------------------------------------------------------------------")
  #print(paste0("Processing jsons to list:"))
  
  L <- length(files)
  
  for(i in 2:L){
    #print(100*(i/L))
    
    f <- fromJSON(files[i])
    j <- c(j,f)
  }
  
  j
  
}

```

```{r}
#define a function to recursively add actual run numbers and concatenate lists
recursive_add <- function(run_number){
  run_number <- paste0("000",run_number)
  
  dirX <- paste0("C:/Users/gerhard/Documents/msc-thesis-data/processed/",run_number)
  dat_ <- wrangle(dirX)
  
  for(i in 1:length(dat_)){
  
  dat_[[i]]$RunNumber <- run_number
  }
  gc()
  return(dat_)
}

```

```{r}
#add first run to initialize dataset

dirX = "C:/Users/gerhard/Documents/msc-thesis-data/processed/000265309"
dat <- wrangle(dirX)

for(i in 1:length(dat)){
  
  dat[[i]]$RunNumber <- "000265309"
  
}

runs1 <- c("265332","265334","265335")
runs2 <- c("265336","265338","265339")
runs3 <- c("265342","265343","265344")
runs4 <- c("265377","265378","265381")
runs5 <- c("265383","265385","265388")
runs6 <- c("265419","265420","265425")
runs7 <- c("265426","265499")

```

# RUNS 1

```{r}

for(i in runs1){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

# RUNS 2

```{r}
rm(dat)
dat <- c()

for(i in runs2){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

# RUNS 3

```{r}
rm(dat)
dat <- c()

for(i in runs3){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

# RUNS 4

```{r}
rm(dat)
dat <- c()

for(i in runs4){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```


# RUNS 5

```{r}
rm(dat)
dat <- c()

for(i in runs5){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```


# RUNS 6

```{r}
rm(dat)
dat <- c()

for(i in runs6){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```


# RUNS 7

```{r}
rm(dat)
dat <- c()

for(i in runs7){
  print(paste0("RUN: ", i))
  dat <- c(dat,recursive_add(i))
  print(length(dat))
}
```


```{r}
names(dat[[1]])
```

```{r}
Eta <- sapply(dat, `[[`,"Eta")
P <- sapply(dat, `[[`,"P")
PT <- sapply(dat, `[[`,"PT")
Phi <- sapply(dat, `[[`,"Phi")
Theta <- sapply(dat, `[[`,"Theta")
dEdX <- sapply(dat, `[[`,"dEdX")
nSigmaElectron <- sapply(dat, `[[`,"nSigmaElectron")
nSigmaPion <- sapply(dat, `[[`,"nSigmaPion")
pdgCode <- sapply(dat, `[[`,"pdgCode")
RunNumber <-  sapply(dat, `[[`,"RunNumber")

dat <- data.frame(cbind(Eta,P,PT,
                              Phi,Theta,dEdX,
                              nSigmaElectron,nSigmaPion,
                              pdgCode,RunNumber))

dat$particleID <- ifelse(abs(as.numeric(as.character(dat$pdgCode)))==211,"pion","electron")
dat$RunNumber <- as.factor(dat$RunNumber)

for(i in 1:8){
  dat[,i] <- as.numeric(as.character(dat[,i]))
}

dat$particleID <- as.factor(dat$particleID)
```



```{r}
require(ggplot2)

ggplot(dat,aes(x=factor(particleID),colour=factor(particleID),fill=factor(particleID)))+
  geom_bar()+
  ggtitle("Number of Electrons and Pions")+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=P,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```

```{r}
ggplot(dat,aes(x=PT,y=dEdX,colour=factor(particleID),alpha=0))+geom_point()+facet_wrap(~RunNumber)
```


```{r}
ggplot(dat[dat$nSigmaElectron!=-999,],aes(x=nSigmaElectron,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```

```{r}
ggplot(dat[dat$nSigmaPion!=-999,],aes(x=nSigmaPion,fill=particleID,alpha=0),position=position_dodge())+
  geom_histogram(bins = 1000)+
  facet_wrap(~RunNumber)
```




























