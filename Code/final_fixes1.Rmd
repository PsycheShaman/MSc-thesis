---
title: "Final thesis plots and fixes"
author: "Gerhard Viljoen"
date: "05/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list=ls())
load("C:/Users/Gerhard/Documents/msc-thesis-data/aux_.rdata")
load("C:/Users/Gerhard/Documents/msc-thesis-data/meta.rdata")
load("C:/Users/Gerhard/Documents/msc-thesis-data/y.rdata")
```


```{r}
names(aux)
names(meta)
```


```{r}
y <- data.frame(y)
pt_pid <- data.frame(cbind(aux$P,aux$PT,ifelse(y$y==0,"pion","electron")))
head(pt_pid)
pt_pid$X1 <- as.numeric(as.character(pt_pid$X1))
pt_pid$X2 <- as.numeric(as.character(pt_pid$X2))
pt_pid$X3 <- as.factor(unlist(pt_pid$X3))
names(pt_pid) <- c("P","Pt","Particle ID")
```

```{r}
n = 6
h1 <- hist(pt_pid$Pt[as.character(pt_pid$`Particle ID`)=="electron"],breaks=n)
           # breaks = c(1.5,2.5,3.5,4.5,5.5,6.5))
h2 <- hist(pt_pid$Pt[as.character(pt_pid$`Particle ID`)=="pion"],breaks=n)
           # breaks=c(1.5,2.5,3.5,4.5,5.5,6.5))

h1$mids==h2$mids

x_elec = h1$mids
x_pion = h2$mids

y_elec = h1$counts
y_pion = h2$counts

df1 <- data.frame(cbind(x_elec,y_elec))
df2 <- data.frame(cbind(x_pion,y_pion))

names(df1) <- names(df2) <- c("Pt","counts")

df <- rbind(df1,df2)
df$`Particle ID` <- c(rep("electron",length(x_elec)),rep("pion",length(x_pion)))

require(ggplot2)
require(latex2exp)

fancy_scientific <- function(l) {
     l <- format(l, scientific = TRUE)
     l <- gsub("^(.*)e", "'\\1'e", l)
     l <- gsub("e", "%*%10^", l)
     parse(text=l)
}

require(extrafont)
# font_import()
# loadfonts(device = "win")

# windowsFonts()
require(MASS)
require(scales)

breaks <- 10^(1:7)
minor_breaks <- rep(1:9, 21)*(10^rep(1:7, each=9))

ggplot(data=df,aes(x=Pt,y=counts,color=`Particle ID`))+xlab(TeX("$\\textit{p}_T (GeV/\\textit{c})$"))+geom_point()+
scale_y_continuous(trans='log10',labels = fancy_scientific,limits=c(10^0, 10^7),breaks = breaks, minor_breaks = minor_breaks)+
  theme( axis.title.x =element_text(size=12,  family="serif"))+ylab(TeX("N"))+
  theme( axis.title.y =element_text(size=12,  family="serif"))+geom_errorbar(ymin=df$counts+
                                                                               sqrt(df$counts),
                                                                             ymax=df$counts-sqrt(df$counts))+
  geom_errorbarh(aes(xmin=df$Pt-0.5,xmax=df$Pt+0.5))+theme(legend.position = c(0.9, 0.85),legend.text = 
                                                             element_text(size=12,  family="serif"),
                                                           legend.title = element_text(size=12,  family="serif"))+ theme( axis.line = element_line(colour = "black", 
                      size = 0.5, linetype = "solid"))+theme(axis.text = element_text(color = "black"))+
  theme(panel.background = element_rect(fill="white",color="black",size=0.01))+
  theme(panel.grid.major = element_line(size = 0.1, linetype = 'solid',colour = "gray90"))+
  theme(panel.grid.minor = element_line(size = 0.1, linetype = 'dashed',colour = "gray90"))+
  theme(legend.box.background = element_rect(colour = "black"),
        legend.background = element_blank(),legend.key = element_blank())+
  annotation_logticks(base=10,sides = "l")
  
```

```{r}

# scale_y_log10() geom_step()+ +geom_point()

breaks <- c(1,2,3,4,5,7,10,15,20)
# minor_breaks <- rep(0:2, 21)*(10^rep(0:2, each=9))

ggplot(data=data.frame(cbind(h1$mids,h2$counts/h1$counts)),aes(x=h1$mids,y=h2$counts/h1$counts))+geom_point()+
  ggtitle(element_blank())+xlab(TeX("\\textit{p}_T (GeV/\\textit{c})"))+ylab(TeX('Relative $\\,\\pi$ abundance: $\\,\\,(\\,\\frac{N_{\\pi}}{N_e}\\,)$'))+scale_y_continuous(trans='log10',limits=c(.1, 30),breaks=breaks)+
  geom_errorbar(aes(ymin=(h2$counts/h1$counts)-sqrt(h2$counts/h1$counts),ymax=(h2$counts/h1$counts)+sqrt(h2$counts/h1$counts),width=.05))+
  geom_errorbarh(aes(xmin=h1$mids-0.5,xmax=h1$mids+0.5))+
  theme( axis.title.x =element_text(size=12,  family="serif"))+
  theme( axis.title.y =element_text(size=12,  family="serif"))+
  theme(panel.grid.major = element_line(size = 0.1, linetype = 'solid',colour = "gray90"))+
  theme(panel.grid.minor = element_line(size = 0.1, linetype = 'dashed',colour = "gray90"))+ theme( axis.line = element_line(colour = "black", 
                      size = 0.5, linetype = "solid"))+theme(axis.text = element_text(color = "black"))+
  theme(panel.background = element_rect(fill="white",color="black",size=0.01))

```

```{r}
rm(list=ls())
load("C:/Users/Gerhard/Documents/msc-thesis-data/y.rdata")
load("C:/Users/Gerhard/Documents/msc-thesis-data/x.rdata")
dim(x) <- c(6573905,17,24)
ph <- apply(x, 1, colSums)

ph_elec_mean <- colMeans(t(ph)[which(y==1),])
ph_pi_mean <- colMeans(t(ph)[which(y==0),])
ph <- cbind(c(ph_elec_mean,ph_pi_mean),rep(c(1,0),each=24))
ph <- setNames(data.frame(ph),c("Pulse height (mV)","Particle ID")) 
ph$`Particle ID` <- factor(ifelse(ph$`Particle ID`==1,"electron","pion"))

```

```{r}

ph$`Drift time (us)` <- seq(from=0,to=2.4,length.out=24)

require(ggplot2)

require(latex2exp)

ggplot(ph,aes(x=`Drift time (us)`,y=`Pulse height (mV)`,color=`Particle ID`))+geom_line()+xlim(c(0,2.8))+
  xlab(TeX("Drift time ($\\mu$s)"))+ylab(TeX("Average pulse height (mV)"))+
  theme( axis.title.x =element_text(size=12,  family="serif"))+
  theme( axis.title.y =element_text(size=12,  family="serif"))+
  theme(panel.grid.major = element_line(size = 0.1, linetype = 'solid',colour = "gray90"))+
  theme(panel.grid.minor = element_line(size = 0.1, linetype = 'dashed',colour = "gray90"))+ theme( axis.line = element_line(colour = "black", 
                      size = 0.5, linetype = "solid"))+theme(axis.text = element_text(color = "black"))+
  theme(panel.background = element_rect(fill="white",color="black",size=0.01))+scale_x_continuous(breaks=0:12*0.2)+
  ylim(c(0,200))
```























